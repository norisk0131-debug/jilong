<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚´ ì‘í’ˆ | ì—¬ë°±ì˜ ì‹œê°„</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
  font-family:'Noto Serif KR',serif;
  background:#f6f2ea;
  color:#3e3a36;
  line-height:1.9;
}

nav{
  text-align:center;
  padding:25px 0;
  font-size:0.9rem;
}
nav a{
  margin:0 18px;
  text-decoration:none;
  color:#555;
}
nav a:hover{opacity:0.6;}

.container{
  max-width:1100px;
  margin:120px auto;
  padding:0 20px;
}

h1{font-weight:400;margin-bottom:10px;}
.subtitle{color:#7a746e;margin-bottom:50px;}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:30px;
}

.card{
  background:#fffdf8;
  padding:30px;
  box-shadow:0 12px 35px rgba(0,0,0,0.05);
}

canvas{
  width:100%;
  margin-bottom:20px;
  background:#fdfbf7;
}

.analysis{
  font-size:0.85rem;
  color:#777;
  margin-bottom:15px;
}

.actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

button{
  padding:6px 14px;
  border:1px solid #3e3a36;
  background:none;
  cursor:pointer;
  font-size:0.8rem;
}
button:hover{
  background:#3e3a36;
  color:#fff;
}

.empty{
  text-align:center;
  padding:100px 0;
  color:#999;
}

footer{
  text-align:center;
  padding:80px;
  font-size:0.8rem;
  color:#aaa;
}
</style>
</head>

<body>

<script>
if(!localStorage.getItem("currentUser")){
  window.location.href="../auth/login.html";
}
</script>

<nav>
<a href="../index.html">Home</a>
<a href="../community.html">Community</a>
<a href="dashboard.html">My</a>
</nav>

<div class="container">
<h1>ë‚´ ì‘í’ˆ</h1>
<div class="subtitle">ë‹¹ì‹ ì˜ ë§ˆìŒì´ ë¨¸ë¬¸ í”ì </div>
<div id="worksContainer" class="grid"></div>
</div>

<footer>Â© 2026 ì—¬ë°±ì˜ ì‹œê°„</footer>

<script>

const currentUser = localStorage.getItem("currentUser");
const works = JSON.parse(localStorage.getItem("savedWorks")) || [];
const myWorks = works.filter(w => w.user === currentUser);
const container = document.getElementById("worksContainer");

if(myWorks.length === 0){
  container.innerHTML = `
  <div class="empty">
    ì•„ì§ ì €ì¥ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.<br><br>
    ì˜¤ëŠ˜ í•œ ë¬¸ì¥ì„ ë‚¨ê²¨ë³´ì„¸ìš”.
  </div>`;
}else{
  myWorks.reverse().forEach((work,index)=>{
    const card=document.createElement("div");
    card.className="card";

    const canvas=document.createElement("canvas");
    canvas.height=200;

    const analysis = analyzeEmotion(work.text);

    card.appendChild(canvas);

    const analysisDiv=document.createElement("div");
    analysisDiv.className="analysis";
    analysisDiv.innerText="AI ê°ì • ë¶„ì„: "+analysis;
    card.appendChild(analysisDiv);

    const actions=document.createElement("div");
    actions.className="actions";

    actions.innerHTML=`
      <button onclick="downloadPNG(this)">PNG ì €ì¥</button>
      <button onclick="deleteWork(${index})">ì‚­ì œ</button>
      <button onclick="saveToCloud('${work.text}')">í´ë¼ìš°ë“œ ì €ì¥</button>
    `;

    card.appendChild(actions);
    container.appendChild(card);

    drawWork(canvas, work.text);
  });
}

/* ìˆ˜ë¬µ ë°°ê²½ + í…ìŠ¤íŠ¸ í•©ì„± */
function drawWork(canvas,text){
  const ctx=canvas.getContext("2d");

  // ë°°ê²½
  const gradient=ctx.createLinearGradient(0,0,canvas.width,canvas.height);
  gradient.addColorStop(0,"#f8f4ec");
  gradient.addColorStop(1,"#ebe4d9");
  ctx.fillStyle=gradient;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // ì‰í¬ ëŠë‚Œ ì›
  ctx.globalAlpha=0.15;
  ctx.beginPath();
  ctx.arc(canvas.width/2,100,80,0,Math.PI*2);
  ctx.fillStyle="#000";
  ctx.fill();
  ctx.globalAlpha=1;

  // í…ìŠ¤íŠ¸
  ctx.font="20px serif";
  ctx.fillStyle="#2e2a26";
  ctx.textAlign="center";
  ctx.fillText(text, canvas.width/2, 110);
}

/* PNG ì €ì¥ */
function downloadPNG(button){
  const canvas=button.closest(".card").querySelector("canvas");
  const link=document.createElement("a");
  link.download="ì—¬ë°±ì˜ì‹œê°„_ì‘í’ˆ.png";
  link.href=canvas.toDataURL();
  link.click();
}

/* ê°ì • ë¶„ì„ (ë¡œì»¬ ê¸°ë°˜) */
function analyzeEmotion(text){
  const positive=["í–‰ë³µ","ê°ì‚¬","ì‚¬ë‘","ê¸°ì¨"];
  const negative=["ì™¸ë¡œì›€","ìŠ¬í””","í˜ë“¤","ì•„í”„"];

  for(let word of positive){
    if(text.includes(word)) return "ë”°ëœ»í•œ ê¸ì •ì˜ íë¦„ ğŸŒ¿";
  }
  for(let word of negative){
    if(text.includes(word)) return "ì”ì”í•œ ìœ„ë¡œê°€ í•„ìš”í•œ ìˆœê°„ ğŸŒ«";
  }
  return "ê³ ìš”í•œ ì‚¬ìƒ‰ì˜ ìƒíƒœ";
}

/* ì‚­ì œ */
function deleteWork(index){
  const allWorks = JSON.parse(localStorage.getItem("savedWorks")) || [];
  const filtered = allWorks.filter(w => w.user === currentUser);
  filtered.splice(index,1);

  const remaining = allWorks.filter(w => w.user !== currentUser);
  const updated = [...remaining, ...filtered];

  localStorage.setItem("savedWorks", JSON.stringify(updated));
  location.reload();
}

/* í´ë¼ìš°ë“œ ì €ì¥ êµ¬ì¡° (í™•ì¥ ì¤€ë¹„) */
function saveToCloud(text){
  alert("Firebase ì—°ë™ ì‹œ ì‹¤ì œ í´ë¼ìš°ë“œì— ì €ì¥ë©ë‹ˆë‹¤.");
}

</script>

</body>
</html>
